---
title: linuxåå°ä¸€ç›´è¿è¡Œflask web
date: 2025-10-28
tags: [linux,web,flask]
---

# linuxåå°ä¸€ç›´è¿è¡Œpython web
æ²¡é—®é¢˜ï¼è¿™æ˜¯ Linux æ–°æ‰‹æœ€å®¹æ˜“é‡åˆ°çš„å›°æƒ‘ä¹‹ä¸€ã€‚

åœ¨ Linux ç»ˆç«¯é‡Œï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ**åªè¦ä½ å…³é—­äº† SSH çª—å£ï¼ˆæˆ–è€…æ–­ç½‘äº†ï¼‰ï¼Œä½ è¿è¡Œçš„æ‰€æœ‰ç¨‹åºéƒ½ä¼šè¢«ç³»ç»Ÿå¼ºåˆ¶æ€æ‰**ã€‚

ä¸ºäº†è®©ä½ çš„ Flask ç½‘ç«™ 24 å°æ—¶åœ¨çº¿ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒâ€œå‰¥ç¦»â€å‡ºæ¥ï¼Œè®©å®ƒåœ¨åå°ç‹¬è‡ªè¿è¡Œã€‚


## æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `screen`ï¼ˆæœ€æ¨èæ–°æ‰‹ï¼Œçœ‹å¾—è§æ‘¸å¾—ç€ï¼‰

`screen` å°±åƒæ˜¯åœ¨æœåŠ¡å™¨é‡Œå¼€äº†ä¸€ä¸ª\*\*â€œè™šæ‹Ÿæ˜¾ç¤ºå™¨â€\*\*ã€‚ä½ å¯ä»¥åœ¨é‡Œé¢è¿è¡Œç¨‹åºï¼Œç„¶åâ€œæ‹”æ‰æ˜¾ç¤ºå™¨çº¿â€ï¼ˆæ–­å¼€è¿æ¥ï¼‰ï¼Œç¨‹åºä¾ç„¶åœ¨è·‘ã€‚ä¸‹æ¬¡ä½ æ¥ä¸Šæ˜¾ç¤ºå™¨ï¼Œè¿˜èƒ½çœ‹åˆ°å®ƒã€‚

#### 1\. å®‰è£… screen

```bash
sudo apt install screen
```

#### 2\. åˆ›å»ºä¸€ä¸ªæ–°çª—å£

ç»™è¿™ä¸ªçª—å£èµ·ä¸ªåå­—ï¼Œæ¯”å¦‚å« `myweb`ï¼š

```bash
screen -S myweb
```

*ä½ ä¼šå‘ç°å±å¹•é—ªäº†ä¸€ä¸‹ï¼Œå¥½åƒæ¸…å±äº†ã€‚å…¶å®ä½ å·²ç»è¿›å…¥äº†â€œè™šæ‹Ÿä¸–ç•Œâ€ã€‚*

#### 3\. è¿è¡Œä½ çš„ç¨‹åº

åœ¨è¿™ä¸ªæ–°çª—å£é‡Œï¼Œåƒå¾€å¸¸ä¸€æ ·è¿è¡Œç¨‹åºï¼š

```bash
python3 server.py
```

*ä½ ä¼šçœ‹åˆ°å±å¹•ä¸Šæ˜¾ç¤º "Running on [http://0.0.0.0:8000](https://www.google.com/search?q=http://0.0.0.0:8000)"ï¼Œç¨‹åºæ­£åœ¨è¿è¡Œä¸­ã€‚*

#### 4\. å…³é”®æ­¥éª¤ï¼šæš‚ç¦»ï¼ˆDetachï¼‰

ç°åœ¨ç¨‹åºåœ¨è·‘äº†ï¼Œæ€ä¹ˆé€€å‡ºæ¥å‘¢ï¼Ÿ

  * æŒ‰ä½é”®ç›˜ä¸Šçš„ **`Ctrl`** ä¸æ”¾ï¼ŒåŒæ—¶æŒ‰ä¸€ä¸‹ **`A`**ã€‚
  * æ¾å¼€æ‰€æœ‰é”®ã€‚
  * æŒ‰ä¸€ä¸‹ **`D`**ã€‚

ä½ ä¼šçœ‹åˆ°æç¤º `[detached]`ï¼Œç„¶åå›åˆ°äº†ä½ åŸæœ¬çš„ç»ˆç«¯ç•Œé¢ã€‚
**æ­¤æ—¶ï¼Œä½ çš„ Flask è¿˜åœ¨åå°è·‘ï¼Œä½ å¯ä»¥æ”¾å¿ƒåœ°å…³é—­ SSH çª—å£äº†ã€‚**

#### 5\. æ€ä¹ˆå›å»çœ‹ï¼Ÿ

å¦‚æœä½ ä»¥åæƒ³çœ‹çœ‹æ—¥å¿—ï¼Œæˆ–è€…æƒ³åœæ­¢ç¨‹åºï¼š

```bash
screen -r myweb
```

*(æ¢å¤åä¸º myweb çš„çª—å£)*

-----

## æ–¹æ³•äºŒï¼šä½¿ç”¨ `nohup`ï¼ˆæœ€ç®€å•ç²—æš´ï¼Œä¸ç®¡ä¸é—®ï¼‰

`nohup` çš„æ„æ€æ˜¯ **"No Hang Up" (ä¸æŒ‚æ–­)**ã€‚å®ƒæ˜¯ä¸€ä¸ªå‘½ä»¤å‰ç¼€ã€‚

#### 1\. è¿è¡Œå‘½ä»¤

ç›´æ¥è¾“å…¥ä¸‹é¢è¿™è¡Œâ€œå¤©ä¹¦â€ï¼š

```bash
nohup python3 server.py > flask.log 2>&1 &
```

**å‘½ä»¤æ‹†è§£ï¼š**

  * `nohup ...`: å‘Šè¯‰ç³»ç»Ÿï¼Œå°±ç®—æˆ‘é€€å‡ºäº† SSHï¼Œä¹Ÿä¸è¦æ€æ‰è¿™ä¸ªè¿›ç¨‹ã€‚
  * `> flask.log`: æŠŠç¨‹åºæ‰“å°çš„æ‰€æœ‰å­—ï¼ˆæ—¥å¿—ï¼‰ï¼Œéƒ½å†™åˆ° `flask.log` è¿™ä¸ªæ–‡ä»¶é‡Œï¼ˆå› ä¸ºåå°è¿è¡Œä½ çœ‹ä¸åˆ°å±å¹•è¾“å‡ºï¼‰ã€‚
  * `2>&1`: æŠŠâ€œé”™è¯¯ä¿¡æ¯â€ä¹Ÿä¸€èµ·å†™è¿›æ—¥å¿—é‡Œã€‚
  * `&` (æœ€æœ«å°¾): æ„æ€æ˜¯â€œç«‹åˆ»æŠŠå®ƒæ‰”åˆ°åå°å»â€ï¼Œä¸è¦å ç”¨æˆ‘çš„å…‰æ ‡ã€‚

#### 2\. æ€ä¹ˆç¡®è®¤å®ƒåœ¨è·‘ï¼Ÿ

è¾“å…¥ï¼š

```bash
ps -ef | grep server.py
```

å¦‚æœçœ‹åˆ°ä¸€è¡Œå­—åŒ…å« `python3 server.py`ï¼Œè¯´æ˜å®ƒæ´»ç€ã€‚

#### 3\. æ€ä¹ˆåœæ­¢å®ƒï¼Ÿ

å› ä¸ºå®ƒåœ¨åå°ï¼Œä½ ä¸èƒ½æŒ‰ `Ctrl+C` åœæ­¢ã€‚ä½ éœ€è¦å…ˆæŸ¥åˆ°å®ƒçš„ **PID (è¿›ç¨‹å·)**ï¼Œç„¶åæ€æ‰å®ƒã€‚

  * å…ˆè¿è¡Œä¸Šé¢çš„ `ps -ef ...`ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ `ubuntu  12345  ...` çš„æ•°å­—ã€‚
  * æ€æ‰å®ƒï¼š`kill 12345`

-----

## ğŸ’¡ ç»ˆææ¨èï¼šåƒ Nginx ä¸€æ ·ç®¡ç† (`systemd`)

ä½¿ç”¨ `systemd` æŠŠä½ çš„ Python ç½‘ç«™å˜æˆåƒ Nginx æˆ– MySQL ä¸€æ ·çš„â€œç³»ç»ŸæœåŠ¡â€ã€‚
è¿™æ ·åšå¥½å¤„æå¤šï¼š

1.  **å¼€æœºè‡ªå¯**ï¼šVPS é‡å¯åï¼Œç½‘ç«™è‡ªåŠ¨å¤æ´»ã€‚
2.  **å´©æºƒé‡å¯**ï¼šå¦‚æœç¨‹åºå› ä¸ºæŠ¥é”™æŒ‚äº†ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®ä½ æŠŠå®ƒæ‹‰èµ·æ¥ã€‚
3.  **ç®¡ç†æ–¹ä¾¿**ï¼šå¯ä»¥ç”¨ `systemctl` å‘½ä»¤ç»Ÿä¸€ç®¡ç†ã€‚

è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼ˆå‡è®¾ä½ çš„ Web æœåŠ¡è„šæœ¬å« `server.py`ï¼Œæ–‡ä»¶å¤¹åœ¨ `/home/ubuntu/line_jp`ï¼‰ï¼š

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæœåŠ¡é…ç½®æ–‡ä»¶

æˆ‘ä»¬éœ€è¦åœ¨ç³»ç»Ÿçš„æœåŠ¡ç›®å½•é‡Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ã€‚åœ¨ç»ˆç«¯è¾“å…¥ï¼š

```bash
sudo nano /etc/systemd/system/linebot_web.service
```

### ç¬¬äºŒæ­¥ï¼šå†™å…¥é…ç½®å†…å®¹

æŠŠä¸‹é¢çš„å†…å®¹å¤åˆ¶è¿›å»ã€‚
**æ³¨æ„ï¼š** è¯·ä»”ç»†æ£€æŸ¥ `User`ï¼ˆç”¨æˆ·åï¼‰å’Œ `WorkingDirectory`ï¼ˆæ–‡ä»¶å¤¹è·¯å¾„ï¼‰æ˜¯å¦å’Œä½ å®é™…çš„ä¸€è‡´ã€‚å¦‚æœä½ ä¸æ˜¯ç”¨ `ubuntu` ç”¨æˆ·ç™»å½•çš„ï¼Œè¯·æ”¹ä¸ºä½ çš„ç”¨æˆ·åã€‚

```ini
[Unit]
Description=My Line Bot Web Server
After=network.target

[Service]
# è¿è¡ŒæœåŠ¡çš„ç”¨æˆ·ï¼ˆå¦‚æœä½ æ˜¯ç”¨ root ç™»å½•çš„ï¼Œå°±å†™ rootï¼›å¦‚æœæ˜¯ ubuntuï¼Œå°±å†™ ubuntuï¼‰
User=ubuntu
# ä½ çš„é¡¹ç›®æ–‡ä»¶å¤¹è·¯å¾„
WorkingDirectory=/home/ubuntu/line_jp
# å¯åŠ¨å‘½ä»¤ï¼ˆæ³¨æ„è¦ç”¨ python3 çš„ç»å¯¹è·¯å¾„ï¼Œé€šå¸¸æ˜¯ /usr/bin/python3ï¼‰
ExecStart=/usr/bin/python3 server.py
# æ€»æ˜¯è‡ªåŠ¨é‡å¯ï¼ˆå¦‚æœæŒ‚äº†ï¼‰
Restart=always
# é‡å¯é—´éš” 5 ç§’
RestartSec=5

[Install]
# å¼€æœºå¯åŠ¨çº§åˆ«
WantedBy=multi-user.target
```

*æŒ‰ `Ctrl+O` -\> å›è½¦ -\> `Ctrl+X` ä¿å­˜é€€å‡ºã€‚*

-----

### ç¬¬ä¸‰æ­¥ï¼šé€šçŸ¥ç³»ç»Ÿå¹¶å¯åŠ¨

1.  **åˆ·æ–°æœåŠ¡åˆ—è¡¨**ï¼ˆè®©ç³»ç»ŸçŸ¥é“ä½ åŠ äº†ä¸ªæ–°æ–‡ä»¶ï¼‰ï¼š

    ```bash
    sudo systemctl daemon-reload
    ```

2.  **å¯åŠ¨æœåŠ¡**ï¼š

    ```bash
    sudo systemctl start linebot_web
    ```

3.  **è®¾ç½®å¼€æœºè‡ªå¯**ï¼ˆè¿™å°±ä¸ç”¨æ€• VPS é‡å¯äº†ï¼‰ï¼š

    ```bash
    sudo systemctl enable linebot_web
    ```

-----

### ç¬¬å››æ­¥ï¼šæ£€æŸ¥çŠ¶æ€

è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œçœ‹çœ‹å®ƒæ˜¯ä¸æ˜¯ç»¿è‰²çš„ `active (running)`ï¼š

```bash
sudo systemctl status linebot_web
```

  * **å¦‚æœæ˜¯ç»¿è‰²**ï¼šæ­å–œä½ ï¼ä½ çš„ Python ç½‘ç«™å·²ç»åœ¨è¿™ä¸ª VPS ä¸Šâ€œæ‰æ ¹â€äº†ã€‚
  * **å¦‚æœæ˜¯çº¢è‰²**ï¼šå®ƒä¼šæ˜¾ç¤ºæŠ¥é”™ä¿¡æ¯ã€‚é€šå¸¸æ˜¯è·¯å¾„å†™é”™äº†ï¼ˆæ¯”å¦‚ `Working Directory` ä¸å¯¹ï¼‰æˆ–è€… `server.py` ä»£ç é‡Œæœ‰é”™ã€‚

-----

### ä»¥åæ€ä¹ˆç®¡ç†ï¼Ÿ

ä»¥åä½ æƒ³é‡å¯ç½‘ç«™ï¼ˆæ¯”å¦‚æ”¹äº† `server.py` çš„ä»£ç ï¼‰ï¼Œå°±ä¸ç”¨æ€è¿›ç¨‹äº†ï¼Œç›´æ¥åƒæ“ä½œ Nginx ä¸€æ ·ï¼š

  * **é‡å¯**ï¼š`sudo systemctl restart linebot_web`
  * **åœæ­¢**ï¼š`sudo systemctl stop linebot_web`
  * **çœ‹æ—¥å¿—**ï¼š`journalctl -u linebot_web -f` (å®æ—¶æŸ¥çœ‹æŠ¥é”™è¾“å‡º)

è¿™å°±æ˜¯æœ€ä¸“ä¸šçš„éƒ¨ç½²æ–¹å¼ï¼