
**`secure_filename()`** åœ¨å¾ˆå¤šæƒ…å†µä¸‹**éå¸¸æœ‰å¿…è¦**ï¼Œå°¤å…¶æ˜¯åœ¨**å¤„ç†ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶**æ—¶ã€‚

---

### ğŸ’¡ èƒŒæ™¯

å½“ä½ è®©ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ï¼ˆæ¯”å¦‚ Flask ä¸­çš„ `request.files['file']`ï¼‰ï¼Œ
ç”¨æˆ·çš„æ–‡ä»¶åå¯èƒ½åŒ…å«å„ç§å±é™©æˆ–ç‰¹æ®Šå†…å®¹ï¼Œæ¯”å¦‚ï¼š

```bash
../../../etc/passwd
my file.png
script<script>.jpg
```

è¿™äº›åå­—åœ¨æ“ä½œç³»ç»Ÿã€æœåŠ¡å™¨ã€æˆ– URL ä¸­ä½¿ç”¨æ—¶å¯èƒ½å¯¼è‡´é—®é¢˜ï¼Œæ¯”å¦‚ï¼š

* è·¯å¾„ç©¿è¶Šæ”»å‡»ï¼ˆPath Traversalï¼‰
* ç‰¹æ®Šå­—ç¬¦é”™è¯¯
* ä¸åŒç³»ç»Ÿç¼–ç ä¸å…¼å®¹
* æ— æ³•æ­£ç¡®ä¿å­˜æˆ–è®¿é—®æ–‡ä»¶

---

### âœ… Flask çš„è§£å†³æ–¹æ³•

Flask æä¾›äº† `werkzeug.utils.secure_filename` æ¥è‡ªåŠ¨æ¸…ç†æ–‡ä»¶åï¼š

```python
from werkzeug.utils import secure_filename

filename = secure_filename(uploaded_file.filename)
uploaded_file.save(f"./uploads/{filename}")
```

`secure_filename("../../../etc/passwd")` ğŸ‘‰ ä¼šå˜æˆ

```bash
etc_passwd
```

`secure_filename("my file.png")` ğŸ‘‰ ä¼šå˜æˆ

```bash
my_file.png
```

---

### âš ï¸ å¦‚æœä¸ç”¨ secure_filename ä¼šæ€æ ·ï¼Ÿ

å‡è®¾ä½ å†™ï¼š

```python
f.save("./uploads/" + f.filename)
```

è€Œç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶åæ˜¯ï¼š

```
../../app.py
```

é‚£ä½ å¯èƒ½**è¦†ç›–æ‰ä½ è‡ªå·±çš„ä»£ç æ–‡ä»¶**ï¼Œç”šè‡³è¢«æ”»å‡»è€…å†™å…¥æ¶æ„è„šæœ¬ã€‚ğŸ˜±

---

### ğŸ’¬ æ€»ç»“

| åœºæ™¯                 | æ˜¯å¦å»ºè®®ç”¨ secure_filename |
| ------------------ | --------------------- |
| ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶             | âœ… å¿…é¡»ç”¨                 |
| ä½ è‡ªå·±åœ¨ä»£ç é‡Œåˆ›å»ºçš„æ–‡ä»¶       | âŒ ä¸éœ€è¦                 |
| æ–‡ä»¶åæ¥è‡ªå¤–éƒ¨ API æˆ–ç¬¬ä¸‰æ–¹è¾“å…¥ | âœ… å»ºè®®ç”¨                 |


# æ”¹è¿› secure_filenameï¼Œè®©ä¸­æ–‡ä¿ç•™

Werkzeug çš„ secure_filename é»˜è®¤åªä¿ç•™ ASCII å­—æ¯ã€‚
ä½ å¯ä»¥å†™ä¸€ä¸ªå°å‡½æ•°ï¼Œä¿ç•™ä¸­æ–‡å’Œå¸¸è§å­—ç¬¦ï¼š
```bash
import re

def safe_filename(filename):
    # ä¿ç•™ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ã€ä¸‹åˆ’çº¿ã€ç‚¹ã€æ¨ªçº¿
    return re.sub(r'[^0-9A-Za-z\u4e00-\u9fa5._-]', '_', filename)

```
ç„¶åæ›¿æ¢åŸæ¥çš„ï¼š

```bash
song_filename = safe_filename(song.filename)
```

è¿™æ ·ï¼š

"å¤å¤©çš„é£ï¼ˆå®Œæ•´ç‰ˆï¼‰.flac" â†’ "å¤å¤©çš„é£_å®Œæ•´ç‰ˆ_.flac"

"My Song.mp3" â†’ "My_Song.mp3"

ä¼šå®‰å…¨åˆç¾è§‚ âœ…